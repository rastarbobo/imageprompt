(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5186],{63794:function(e,t,s){Promise.resolve().then(s.bind(s,90742)),Promise.resolve().then(s.bind(s,30164)),Promise.resolve().then(s.bind(s,68779)),Promise.resolve().then(s.bind(s,88999)),Promise.resolve().then(s.bind(s,41299)),Promise.resolve().then(s.t.bind(s,23993,23))},90742:function(e,t,s){"use strict";s.d(t,{default:function(){return T}});var a=s(83009),r=s(45291),l=s(80229),o=s(6335);function n(e){let{onImageUpload:t}=e,s=(0,l.useTranslations)("batchImageToPrompt"),[n,i]=(0,r.useState)([]),c=async e=>{let t=URL.createObjectURL(e);try{let s=await (0,o.tg)(e,600,600),a=await (0,o.w8)(s);return{fileName:e.name,previewUrl:t,base64Url:a,status:"success"}}catch(s){return{fileName:e.name,previewUrl:t,status:"error",error:s.message}}},d=async e=>{if(e.length>20){alert(s("tooManyFiles",{max:20}));return}let a=Array.from(e).filter(e=>e.type.startsWith("image/"));i(a.map(e=>({fileName:e.name,previewUrl:"",status:"loading"})));let r=await Promise.all(a.map(c));i(r),t(r.filter(e=>"success"===e.status&&e.base64Url).map(e=>({fileName:e.fileName,base64Url:e.base64Url})))},m=()=>({total:n.length,success:n.filter(e=>"success"===e.status).length,error:n.filter(e=>"error"===e.status).length});return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 md:gap-8",children:[(0,a.jsxs)("div",{className:"w-full md:w-1/2 flex flex-col",children:[(0,a.jsx)("h2",{className:"pl-0 md:pl-4 text-lg font-semibold mb-2 md:mb-6",children:s("uploadImageTitle")}),(0,a.jsx)("div",{className:"space-y-6 flex-grow flex flex-col",children:(0,a.jsx)("div",{className:"pl-0 md:pl-4 rounded flex-grow",children:(0,a.jsxs)("label",{htmlFor:"file-upload",className:"flex items-center justify-center h-48 bg-secondary rounded border border-dashed border-gray-400 cursor-pointer",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{var t;e.preventDefault(),e.stopPropagation(),(null===(t=e.dataTransfer.files)||void 0===t?void 0:t.length)&&d(e.dataTransfer.files)},children:[(0,a.jsx)("input",{id:"file-upload",type:"file",accept:"image/*",onChange:e=>{var t;(null===(t=e.target.files)||void 0===t?void 0:t.length)&&d(e.target.files)},className:"hidden",multiple:!0,"aria-label":"Upload image files"}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{className:"mt-1 text-sm text-secondary-foreground",children:s("uploadImageInstruction")}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:s("uploadImageFormats")})]})]})})})]}),(0,a.jsxs)("div",{className:"w-full md:w-1/2 flex flex-col order-last md:pr-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2 md:mb-6",children:s("imagePreviewTitle")}),(0,a.jsxs)("div",{className:"rounded bg-secondary h-48 flex flex-col",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:n.length>0?(0,a.jsx)("div",{className:"p-2 space-y-2",children:n.map((e,t)=>(0,a.jsxs)("div",{className:"flex flex-col p-2 bg-background rounded",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 flex items-center justify-center",children:"error"===e.status?(0,a.jsx)("svg",{className:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):e.previewUrl&&(0,a.jsx)("img",{src:e.previewUrl,alt:e.fileName,className:"max-w-full max-h-full object-contain"})}),(0,a.jsx)("span",{className:"flex-1 text-sm truncate",children:e.fileName}),(0,a.jsx)("span",{className:"text-sm ".concat("loading"===e.status?"text-gray-500":"success"===e.status?"text-green-500":"text-red-500"),children:"loading"===e.status?s("processing"):"success"===e.status?s("success"):s("error")})]}),"error"===e.status&&e.error&&(0,a.jsx)("p",{className:"mt-1 ml-11 text-xs text-red-500",children:e.error})]},t))}):(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-muted-foreground",children:[(0,a.jsx)("svg",{className:"h-12 w-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{className:"text-sm mt-2",children:s("imagePreviewPlaceholder")})]})}),n.length>0&&(0,a.jsxs)("div",{className:"p-2 text-sm border-t border-border",children:[(0,a.jsx)("span",{children:s("fileSelected",{count:m().total})}),m().error>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"mx-2 text-muted-foreground",children:"|"}),(0,a.jsx)("span",{children:s("fileSuccess",{count:m().success})}),(0,a.jsx)("span",{className:"mx-2 text-muted-foreground",children:"|"}),(0,a.jsx)("span",{className:"text-red-500",children:s("fileError",{count:m().error})})]})]})]})]})]})}var i=s(99562),c=s(7011),d=s(41677),m=s(44834),x=s(40496),u=s(51138),p=s(98599),h=s(98997),f=s(79735),g=s(97166),j=s(26892),v=s(94721),b=s(31009),w=s(19375),N=s(11138),y=s(18498),_=s(94230),k=s(6043),C=s(60846),L=s(80442);function P(e){let{items:t,onCopy:s}=e,o=(0,l.useTranslations)("batchImageToPrompt"),[n,i]=r.useState(null),c=(e,t)=>{s(e),i(t),setTimeout(()=>i(null),2e3)};return(0,a.jsx)("div",{className:"mt-4 space-y-4 mx-0 md:mx-4",children:t.map((e,t)=>{var s,r;return(0,a.jsx)("div",{className:"bg-background rounded p-4 border border-border",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"relative w-20 h-20 flex-shrink-0",children:(0,a.jsx)(L.default,{src:e.base64Url,alt:e.fileName,fill:!0,className:"object-cover rounded"})}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsx)("h3",{className:"font-medium text-sm break-words",children:e.fileName})})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("textarea",{value:"waiting"===e.status?o("waiting"):"processing"===e.status?o("generating"):null!==(r=null!==(s=e.prompt)&&void 0!==s?s:e.error)&&void 0!==r?r:"",readOnly:!0,className:"w-full h-24 p-2 text-sm border border-border rounded bg-muted resize-none pr-10 ".concat("error"===e.status?"text-red-500":"")}),"processing"===e.status&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded",children:(0,a.jsx)(_.Z,{className:"w-8 h-8 animate-spin text-primary"})}),"success"===e.status&&e.prompt&&(0,a.jsx)("button",{onClick:()=>c(e.prompt,t),className:"absolute top-2 right-2 p-1 text-gray-500 hover:text-purple-700 transition-colors",title:n===t?o("copied"):o("copyPrompt"),children:n===t?(0,a.jsx)(k.Z,{className:"h-4 w-4"}):(0,a.jsx)(C.Z,{className:"h-4 w-4"})})]})]})},t)})})}var S=s(97528);function T(e){let{currentURL:t,userId:s}=e,o=(0,l.useTranslations)("imageToPrompt"),_=(0,l.useTranslations)("batchImageToPrompt"),[k,C]=(0,r.useState)([]),[L,T]=(0,r.useState)(!1),[U,E]=(0,r.useState)(!1),[I,F]=(0,r.useState)(null),[M,R]=(0,r.useState)(!1),[B,O]=(0,r.useState)(u.cs.GENERAL),[z,H]=(0,r.useState)("en"),[W,Z]=(0,r.useState)(!1),[A,D]=(0,r.useState)(!1),{trackEvent:G}=(0,c.z)(),{trackUmamiEvent:V}=(0,d.M)(),[J,$]=(0,r.useState)({dailyUsage:0,dailyLimit:-1,packsBalance:[]}),K=(0,r.useCallback)(async()=>{if(s)try{let e=await (0,b.Gu)(s);console.log("balance",e),$(e)}catch(e){console.error("Error fetching usage stats:",e)}},[s]);(0,r.useEffect)(()=>{K()},[K,s]);let q=async()=>{if(0!==k.length){if(!s){var e;let t=parseInt(null!==(e=localStorage.getItem("promptGenerationCount"))&&void 0!==e?e:"0");if(t>=0){R(!0),V("show_login_batch_image_to_prompt");return}localStorage.setItem("promptGenerationCount",(t+1).toString())}T(!0),F(null),V("batch_image_to_prompt",{image_count:k.length});for(let e=0;e<k.length;e++){C(t=>t.map((t,s)=>s===e?{...t,status:"processing"}:t));try{let t=await (0,i.SN)(k[e].base64Url,B,z);C(s=>s.map((s,a)=>a===e?{...s,status:"success",prompt:t.prompt}:s)),t.prompt&&g.a.addHistory({id:(0,j.Z)(),prompt:t.prompt,modelId:B,language:z,timestamp:Date.now()},null!=s?s:void 0),await K()}catch(t){if(C(s=>s.map((s,a)=>a===e?{...s,status:"error",error:t instanceof Error?t.message:"An unknown error occurred"}:s)),t instanceof Error&&"UnauthorizedError"===t.name){R(!0),G("show_login_image_to_prompt",{reason:"rate_limit_exceeded_by_ip"});break}}}T(!1)}},Q=()=>k.some(e=>"success"===e.status||"error"===e.status);return(0,a.jsxs)("div",{className:"container mx-auto px-4 max-w-6xl",children:[M&&(0,a.jsx)(x.u,{isOpen:M,onClose:()=>R(!1),children:(0,a.jsx)(m.LoginForm,{redirectToURL:t})}),A&&(0,a.jsx)(x.u,{isOpen:A,maxWidth:"max-w-lg",onClose:()=>D(!1),children:(0,a.jsx)(N.K,{resetTime:(0,w.EJ)(),onClose:()=>D(!1)})}),W&&(0,a.jsx)(x.u,{isOpen:W,onClose:()=>Z(!1),maxWidth:"max-w-4xl",children:(0,a.jsxs)("div",{className:"p-2",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-2",children:o("promptHistory.promptHistory")}),(0,a.jsx)(f.s,{userId:null!=s?s:void 0})]})}),(0,a.jsx)("div",{className:"rounded overflow-hidden",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"w-full bg-muted rounded p-4",children:[(0,a.jsx)(n,{onImageUpload:e=>{C(e.map(e=>({...e,status:"waiting"}))),F(null)}}),(0,a.jsxs)("div",{className:"flex flex-col items-start py-2 md:py-4",children:[(0,a.jsx)("div",{className:"w-full px-0 md:px-4",children:(0,a.jsx)("hr",{className:"w-full my-2 md:my-4 border-t border-gray/10"})}),(0,a.jsx)(p.Z,{onModelChange:e=>{O(e)}}),(0,a.jsx)("div",{className:"flex flex-col sm:flex-row justify-start items-center gap-4 mt-4 w-full px-0 md:px-4",children:(0,a.jsxs)("div",{className:"w-full flex items-center space-x-2",children:[(0,a.jsx)("label",{htmlFor:"promptLanguage",className:"text-base font-semibold leading-6 text-foreground whitespace-nowrap",children:o("promptLanguage")}),(0,a.jsx)(h.Z,{value:z,onChange:e=>{H(e)},className:"flex-grow max-w-[300px]"})]})}),"en"!==z&&(0,a.jsx)("div",{className:"mt-4 px-4 bg-muted rounded",children:(0,a.jsx)("p",{className:"text-xs text-muted-foreground text-center italic",children:o("englishPromptRecommendation")})}),(0,a.jsx)("div",{className:"flex justify-center w-full",children:(0,a.jsx)("div",{className:"mt-4 bg-yellow-50 dark:bg-card p-4 mx-0 md:mx-4 rounded max-w-6xl w-full",children:(0,a.jsxs)("p",{className:"space-y-1 text-base font-normal text-yellow-800 dark:text-muted-foreground mt-2",children:[(0,a.jsx)("span",{className:"block",children:_("usageNotice")}),(0,a.jsx)("span",{className:"block italic",children:_("generationWarning")})]})})}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 md:gap-4 mt-6 px-0 sm:flex-row md:px-4 w-full md:w-auto",children:[(0,a.jsx)("div",{className:"w-full flex flex-col items-center sm:items-center sm:justify-start gap-4",children:(0,a.jsx)("button",{onClick:q,disabled:0===k.length||L||!!s&&J&&!(0,w.$R)(J,k.length),className:"w-full sm:w-auto px-4 md:px-6 py-2 bg-[#7F00FF] text-white rounded hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition duration-300 ease-in-out text-2xl font-bold flex items-center justify-center",children:L?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o("generatingPrompt")]}):o("generatePrompt")})}),s&&(0,a.jsx)(v.l,{balance:J,nextResetTime:(0,w.EJ)()}),(0,a.jsx)("button",{onClick:()=>{V("view_prompt_history_batch_image_to_prompt"),Z(!0)},className:"text-primary text-sm hover:underline hover:text-primary transition-colors whitespace-nowrap",children:o("promptHistory.viewHistory")})]}),s&&J&&!(0,w.$R)(J,k.length)&&k.length>0&&(0,a.jsx)("div",{className:"mt-4 text-red-500 text-sm px-0 md:px-4 w-full",children:_.rich("insufficientBalance",{count:k.length,Link:e=>(0,a.jsx)(S.rU,{href:"/pricing",className:"text-blue-600 hover:underline font-medium inline-flex items-center",children:e})})}),I&&(0,a.jsx)("div",{className:"px-4 mt-2 text-red-500 text-center",children:I})]}),k.length>0&&k.some(e=>"waiting"!==e.status)&&(0,a.jsxs)("div",{className:"flex justify-end gap-4 mt-4",children:[(0,a.jsx)("button",{onClick:()=>{let e=k.map(e=>"success"===e.status&&e.prompt?"[".concat(e.fileName,"] ").concat(e.prompt.replace(/\n/g," ")):"error"===e.status?"[".concat(e.fileName,"] "):null).filter(Boolean).join("\n");e&&(navigator.clipboard.writeText(e),E(!0),setTimeout(()=>E(!1),2e3),V("copy_all_prompts_batch_image_to_prompt"))},disabled:!Q()||L,className:"px-2 py-1 border-primary border text-primary rounded text-xs hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition duration-300 ease-in-out",children:_(U?"copied":"copyAll")}),(0,a.jsx)("button",{onClick:()=>{let e=k.map(e=>"success"===e.status&&e.prompt?'"'.concat(e.fileName,'","').concat(e.prompt.replace(/\n/g," ").replace(/"/g,'""'),'"'):"error"===e.status?'"'.concat(e.fileName,'",""'):null).filter(Boolean).join("\n"),t=new Blob(["FileName,Prompt\n".concat(e)],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download="prompts.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s),V("download_prompts_csv_batch_image_to_prompt")},disabled:!Q()||L,className:"px-2 py-1 border-primary border text-primary rounded text-xs hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition duration-300 ease-in-out",children:_("downloadCSV")})]}),k.length>0&&k.some(e=>"waiting"!==e.status)&&(0,a.jsx)(P,{items:k,onCopy:e=>{navigator.clipboard.writeText(e).then(()=>{V("copy_single_prompt_batch_image_to_prompt")}).catch(e=>console.error("Copy failed:",e))}})]}),(0,a.jsx)(y.u,{})]})})]})}},6043:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.372.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(69830).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])}},function(e){e.O(0,[8415,342,4434,6083,229,6587,4223,1960,6770,7372,2776,3482,9453,5019,4738,943,8774,561,6479,4335,1744],function(){return e(e.s=63794)}),_N_E=e.O()}]);